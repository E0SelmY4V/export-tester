((exp)=>{/*! For license information please see index.js.LICENSE.txt */
(()=>{"use strict";var t={569:(t,e,n)=>{const o=n(575),r=n(299),i=n(147),c=n(292),s=n(637),u=n(46),a=n(81),f=n(17),l=s(o.configSchema);function p(t,e){"number"==typeof e?console.log(`+-------------------\n| [${e}m ${t} [0m`):e.disp.stat&&console.log(`| ${t}`)}function h(...t){return u.snake(t).trap(((t,...e)=>console.error(`[31m${t}[0m`,...e)))}function d(t,e,n){n.disp.path&&t.forEach((t=>p(`[4m[34m${f.normalize(__dirname+t)}[0m`,n))),a.fork(__dirname+t[0]).on("close",e)}function g(t,e){return(n,o,r)=>c.writeFile(`${__dirname}/test/test.${e}`,o[t]+n).then(r)}const m={ts:"ts","webpack-cjs":"cjs","webpack-esm":"esm","node-cjs":"cjs","node-esm":"esm"},y={esm:g("esm","m.js"),cjs:g("cjs","c.js"),ts:g("ts","ts")},w={ts(t){p("TS",44);const e=t.cfg.ts;return h((e=>{a.exec("tsc -v",e),p("Testing cli",t)}),((n,o,r,i,c)=>{if(r)return o('Have you installed "tsc" ?',r,i,c);p("Compiling",t),a.exec(`tsc${e.path?" -p "+f:""} ${__dirname}/test/test.ts ${e.cmd||""}`,n)}),((e,n,o,r,i)=>{if(o)return n("Compilation failed.",o,r,i);d(["/test/test.js","/test/test.ts"],e,t)}))},node:(t,e)=>h((n=>{p("Copying test file",t),i.cp(`${__dirname}/test/test.${e}.js`,`${__dirname}/test/node.${e}js`,n)}),(n=>{d([`/test/node.${e}js`],n,t)})),"node-esm":t=>(p("Node ESM",45),w.node(t,"m")),"node-cjs":t=>(p("Node CJS",43),w.node(t,"c")),webpack(t,e){const n=t.cfg.webpack,o=`${__dirname}/test/webpack.config.js`;return h((e=>{a.exec("webpack -h",e),p("Testing cli",t)}),((e,r,c,s,u)=>{if(c)return r('Have you installed "webpack" ?',c,s,u);p("Copying configs",t),n.path?i.cp(n.path,o,e):i.writeFile(o,"",e)}),((n,r,c)=>{if(c)return r("Cannot copy the config JS file.",c);p("Modifying configs",t),i.writeFile(o,`\n\t\t\t\t\t;\n\t\t\t\t\tmodule || (module = {});\n\t\t\t\t\tmodule.exports  || (module.exports = {});\n\t\t\t\t\tmodule.exports.output  || (module.exports.output = {});\n\t\t\t\t\tmodule.exports.output.path = __dirname;\n\t\t\t\t\tmodule.exports.output.filename = 'webpack.${e}.js';\n\t\t\t\t\tmodule.exports.mode || (module.exports.mode = 'development');\n\t\t\t\t\tmodule.exports.entry = __dirname + '/test.${e}.js';\n\t\t\t\t`,{flag:"a"},n)}),((e,o,r)=>{if(r)return o("Cannot modify the config JS file.",r);p("Compiling",t),a.exec(`webpack ${n.cmd||""} -c ${__dirname}/test/webpack.config.js`,e)}),((n,o,r,i,c)=>{if(r)return o("Compilation failed.",r,i,c);d([`/test/webpack.${e}.js`,`/test/test.${e}.js`],n,t)}))},"webpack-esm":t=>(p("webpack ESM",42),w.webpack(t,"m")),"webpack-cjs":t=>(p("webpack CJS",46),w.webpack(t,"c"))};function b(){return u.snake((t=>i.access(__dirname+"/test",i.constants.F_OK,t)),((t,e,n)=>n?i.mkdir(__dirname+"/test",t):t()))}async function v(t,e){await b(),await j();const n=l(t),o=JSON.stringify(n.pack||"./"+f.relative(__dirname+"/test",n.file)),i=`var ${n.sign}=require(${o});`,c=`import ${n.sign} from ${o};`,s=`import ${n.sign} ${n.cfg.ts.cjsMod?`=require(${o})`:`from ${o}`};`;let a='\nfunction log(...params) { console.log("| ", ...params) }\n';for(var p in e)a+=`console.log('|\\n+-\\x1b[32m${JSON.stringify(p)}:\\x1b[0m');(function(){\n\n`+r.getInnerCode(e[p])+"\n\n})();";a+='console.log("|");',await function(t,e,n){const o={};return u.snake(t.map((t=>m[t])).map((t=>r=>t in o?r():(o[t]=0,y[t](e,n,r)))))}(n.req,a,{cjs:i,esm:c,ts:s}),await u.snake(n.req.map((t=>async e=>t in w?(await w[t](n),e()):e())))}async function j(){await b();const t=await c.readdir(__dirname+"/test");await u.snake(t.map((t=>e=>i.unlink(`${__dirname}/test/${t}`,e))))}v.clear=j,exp.exports=v.test=v,t.exports=v},575:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.configSchema=void 0,e.configSchema={$schema:"http://json-schema.org/draft-07/schema",type:"object",properties:{disp:{type:"object",properties:{path:{type:"boolean",default:!0},stat:{type:"boolean",default:!0}}},req:{type:"array",items:{type:"string",enum:["ts","node-esm","node-cjs","webpack-esm","webpack-cjs"]},default:["ts","node-esm","node-cjs","webpack-esm","webpack-cjs"]},cfg:{type:"object",properties:{ts:{type:"object",properties:{path:{type:"string",default:""},cmd:{type:"string",default:""},cjsMod:{type:"boolean",default:!1}}},webpack:{type:"object",properties:{path:{type:"string",default:""},cmd:{type:"string",default:""}}}}},sign:{type:"string",default:"a"},file:{type:"string",default:null},pack:{type:"string",default:""}}}},299:t=>{!function(){var e={" ":0,"\t":0,"\n":0,"\r":0},n=!"."[0],o=n?function(t){return t.join("")}:function(t){return t};function r(t){for(t=" "+function(t,e){for(var n=e.length-1;n>=0;n-=2)t=t.split(e[n-1]).join(e[n]);return t}(t,["\n"," ","\r"," ","\t"," "])+" ";-1!==t.indexOf("  ");)t=t.split("  ").join(" ");return t.slice(1,-1)}function i(t){for(var e=[],n=0;n<t.length;++n)t[n]&&e.push(t[n]);return e}function c(t){this.quo=t}function s(t){var e,n=[new c],s=0,u=n[s],a=!1,f=[],l=0;for(e=0;e<t.length;++e)if(a)switch(t[e]){case"$":u.had$=!0;continue;case u.quo:n.pop(),u=n[--s],a=!1,f.push(o(t.slice(l,l=e+1)));continue;case"\\":++e,delete u.had$;continue;case"{":"`"===u.quo&&u.had$&&(n.push(new c),u=n[++s],a=!1,f.push(o(t.slice(l,l=e+1)))),delete u.had$;continue;default:delete u.had$;continue}else switch(t[e]){case"'":case"`":case'"':n.push(new c(t[e])),u=n[++s],a=!0,f.push(r(o(t.slice(l,l=e))));continue;case"{":case"[":case"(":++u.depth;continue;case"}":case"]":case")":case",":if(0===u.depth&&0===s)return{code:(f.push(r(o(t.slice(l,e)))),i(f).join(" ")),index:e,nofin:","===t[e]};","!==t[e]&&(u.depth--||(n.pop(),u=n[--s],a=!0,f.push(r(o(t.slice(l,l=e))))));continue;default:continue}return f.push(r(o(t.slice(l)))),{code:i(f).join(" "),index:e,nofin:!1}}function u(t,e){for(var n=t.length-1;n>=0;--n)if(e===t[n])return n;return-1}function a(t){for(var e,n=[],o=0;e=s(t),n.push(e.code),t=t.slice(e.index+1),o+=e.index+1,e.nofin;);return{params:n,index:o}}function f(t,e,n,o,r){return{params:i(t),innerCode:e,nameCode:n,name:o.name,code:o.toString(),isAsync:r}}function l(t){var r,i,c=n?t.toString().split(""):t.toString(),l=[0],p=0,h=l[p],d="",g=0,m=!1;function y(t){l.push(t),h=l[++p]}function w(){l.pop(),h=l[--p]}for(var b=0;b<c.length;++b)switch(h){case 0:switch(c[b]){case"(":g=b+1,w(),y(2),y(1);continue;case"[":g=b+1,w(),y(6);continue;case" ":case"\t":case"\n":case"\r":continue;default:w(),y(4)}continue;case 1:b=(i=a(c.slice(g))).index+g-1,r=i.params,w();continue;case 2:">"===c[b]&&(w(),y(3));continue;case 3:switch(c[b]){case" ":case"\t":case"\n":case"\r":continue;case"{":return f(r,(m?"return await(async()=>":"return (()=>")+o(c.slice(b))+")();",d,t,m);default:return f(r,"return "+o(c.slice(b))+";",d,t,m)}continue;case 4:switch(c[b]){case"(":c[b-1]in e?(g=b+1,w(),y(5),y(1)):(n?c.splice(b,0," "):c=c.slice(0,b)+" "+c.slice(b),--b);continue;case" ":case"\t":case"\n":case"\r":"function"===o(c.slice(g,b))||("async"===o(c.slice(g,b))?(w(),y(0),m=!0):d||(d='"'+o(c.slice(g,b))+'"')),g=b+1;continue;case">":r=[d.slice(1,-1)],d="",w(),y(3);continue}continue;case 5:if("{"===c[b])return f(r,o(c.slice(b+1,u(c,"}"))),d,t,m);continue;case 6:d=(i=s(c.slice(g))).code,b=i.index+g,w(),y(7);continue;case 7:"("===c[b]&&(g=b+1,w(),y(5),y(1));continue}}c.prototype={quo:"",depth:0,had$:!1};var p={getCode:function(t){return t.toString()},split:l,getInnerCode:function(t){return l(t).innerCode},getParams:function(t){return l(t).params},getNameCode:function(t){return l(t).nameCode},isAsync:function(t){return l(t).isAsync}};t.exports=p[["defa","ult"].join("")]=p}()},46:(t,e)=>{!function(){var n=void 0===e;function o(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2]);default:return t.apply(e,n)}}function r(t){return"object"==typeof t&&"function"==typeof t.then}function i(t){return"object"==typeof t&&isFinite(t.length)}function c(t){return t instanceof k}function s(t){return i(t[0])?t[0]:t}($.notModule=n)?window.scpoProce=$:t.exports=$,$.apply=o,$.isThenable=r,$.isArrayLike=i,$.isProce=c,$.arrayFrom=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},$.getList=s;var u=!1,a=0,f=1;function l(){return(u=!u)?a--:f++}function p(){this.index={}}$.getId=l;var h={then:function(t,e){for(var n=this.length-1;n>=0;n--)j(this[n],t,e)},trap:function(t){return this.then(null,t)},supp:function(t){for(var e=this.length-1;e>=0;e--)this[e].uncaught&&j(this[e],null,t)},pointer:0,index:null};for(var d in p.prototype=[],h)p.prototype[d]=h[d];function g(t,e){for(var n in t)this[n]=t[n];"object"==typeof e&&(this.proc=e)}function m(t,e,n){return t.nmArg?e(n):(t.nmArg=!0,o(e,null,n))}function y(t,e,n){var i=[function(){c&&(c=!1,w(t,arguments))},function(){c&&(c=!1,w(t,b(t,arguments)))}],c=!0;if(n)for(var s=0;s<n.length;s++)i.push(n[s]);try{var u=o(e,t,i);return"none"!==t.config.trap&&r(u)&&("function"==typeof u.getBefore?u.getBefore(new p)["all"===t.config.trap?"trap":"supp"](i[1]):u.then(null,i[1])),t.acted=!0,u}catch(e){return t.acted=!0,i[1](e)}}function w(t,e){for(var n=t.pointer,o=t.queuetodo,r=!0;++n<o.length;)if("function"==typeof o[n]){o[n].hidden||(r=!1);try{e=m(t,o[n],e)}catch(o){t.pointer=n,e=b(t,o),n=t.pointer}}r&&(t.lastDef=setTimeout((function(){t.then(t.config.todo,t.config.ordo)}))),t.lastRtn=e,t.cleared=!0}function b(t,e){for(var n=t.pointer,o=t.queueordo;++n<o.length;)if("function"==typeof o[n]){t.pointer=n;try{return m(t,o[n],e)}catch(e){return b(t,e)}}return t.pointer=n,v(t,t.nmArg?e:e[0]),e}function v(t,e){t.lastErr=setTimeout((function(){if(null!==t.lastDef)return v(t,e);if(n&&!window.console)throw e;return console.error("scpo-proce Uncaught",e)}))}function j(t,e,n){var o="function"==typeof n,r="function"==typeof e;if(t.uncaught&&(t.uncaught=!o),t.cleared){t.pointer++;var i=e&&e.hidden;i||(clearTimeout(t.lastDef),t.lastDef=null);try{null===t.lastErr?r&&(t.lastRtn=m(t,e,t.lastRtn)):o&&(i&&(clearTimeout(t.lastDef),t.lastDef=null),clearTimeout(t.lastErr),t.lastErr=null,t.lastRtn=m(t,n,t.lastRtn))}catch(e){t.lastRtn=e,v(t,e)}}else t.queueordo.push(n),t.queuetodo.push(e)}function k(t,e,n){this.queuetodo=[],this.queueordo=[],this.config=new g(e,this),this.id=l(),n?this.cleared=!0:"function"==typeof t&&y(this,t)}$.ProceArray=p,g.configAll=function(t){for(var e in t)g.prototype[e]=t[e];k.prototype.uncaught="function"!=typeof g.prototype.ordo},g.prototype={set:function(t){for(var e in t)this[e]=t[e];this.proc.uncaught="function"!=typeof this.ordo},get:function(t){if("object"!=typeof t)return this;for(var e in this)void 0===t[e]&&(t[e]=this[e]);return t},trap:"all",proc:null,todo:null,ordo:null},$.ConfigClass=g,$.config=new g,$.doRtn,$.act=y,$.clear=w,$.exeordo=b,$.toss=v,$.tpus=j,k.prototype={id:NaN,queuetodo:null,queueordo:null,cleared:!1,acted:!1,nmArg:!1,lastRtn:[],lastErr:null,lastDef:null,config:null,pointer:-1,before:null,uncaught:!0,then:function(t,e){return c(this)?("none"!==this.config.trap&&this.getBefore()["all"===this.config.trap?"trap":"supp"](e),j(this,t,e),this):new k(null,null,!0).then(t,e)},trap:function(t){return this.then(null,t)},next:function(t,e,n){if(!c(this))return new k(null,null,!0).next(t,e,n);if("function"!=typeof t)return this.then(t,e).conf(n);var o=new k(null,this.config.get(n)),r=function(){return y(o,t,arguments)};return r.hidden=!0,this.then(r,e),o.before=this,o.trap(e)},take:function(t,e,n){"number"==typeof t?n=t:void 0===n&&(n=-1);var i,c=this,s=new k((function(t,e){c.then(i=function(c){r(c)&&0!=n--?c.then(i,e):o(t,null,arguments)},e)}));return"function"==typeof t||"function"==typeof e?s.then(t,e):s},grab:function(t,e,n,o){return this.take(n).next(t,e,o)},getBefore:function(t){return this.before?t?t.index[this.id]?t:(t.push(this),t.index[this.id]=!0,this.before.getBefore(t)):this.before.getBefore(new p):t||new p},setBefore:function(t){return t&&(t.pointer||(t.pointer=0))!==t.length?(this.before=t[t.pointer++]).setBefore(t):delete this.before,this},conf:function(t,e){if(!c(this))return new k(null,null,!0).conf(t);var n=this.config,o=function(e){return n.set(t),e};return o.hidden=!0,this.then(o,e)},configAll:function(t){return g.configAll(t),this},todo:function(){var t=new k(null,null,!0);return t.lastRtn=arguments,t},ordo:function(){var t=new k(null,null,!0);return t.lastRtn=arguments,v(t,arguments[0]),t},all:function(){var t=s(arguments),e=[[]],n=t.length,i=n;return new k((function(c,s){for(;--n>=0;)r(t[n])?function(n){t[n].then((function(){for(var t=arguments,r=t.length;--r>=0;)(e[r]||(e[r]=[]))[n]=t[r];0==--i&&o(c,null,e)}),s)}(n):(--i,e[0][n]=t[n]);i||o(c,null,e)}))},one:function(){var t=s(arguments);return new k((function(e,n){for(var o=0;o<t.length;o++){if(!r(t[o]))return this.acted?void 0:e(t[o]);t[o].then(e,n)}}))},snake:function(){var t=s(arguments),e=this;return new k((function(n,o){for(var r=0;r<t.length;r++)e=e.next(t[r],o);e.then(n,o)}))}};var x=k.prototype.todo;function $(t,e){return"function"==typeof t?new k(t,e):o(x,null,arguments)}$.Proce=k,h=k.prototype;var _=["then","trap","next","conf","configAll","todo","ordo","snake","all","one"];for(d=_.length-1;d>=0;--d)$[_[d]]=h[_[d]];$.emptyProce=function(t){return new k(null,t)}}()},81:t=>{t.exports=require("child_process")},147:t=>{t.exports=require("fs")},292:t=>{t.exports=require("fs/promises")},17:t=>{t.exports=require("path")},637:t=>{(()=>{const e={bigint:"number",number:"number",boolean:"boolean",string:"string",symbol:"object",function:"object",undefined:"null",object:!1},n=t=>e[typeof t]||(t?isFinite(t.length)?"array":"object":"null"),o={notKey(t,e){const n=`'${t}' is not a key of { ${Object.keys(e).map((t=>t+"; ")).join("")}}`;throw ReferenceError(n)},notType(t,e){const n=`Type '${t}' is not assignable to type '${e.join(" | ")}'`;throw TypeError(n)}},r={...((t,e=!0)=>(t.push({}),t.reduceRight(((t,n)=>(t[n]=e,t)))))(["boolean","integer","null","number","string"],(t=>(e=t)=>e)),object(t,e,n){const r={},c=e.check||e.checkKey?function(t){for(const e in t)e in r?this[e]=r[e](t[e]):o.notKey(e,r)}:function(t){for(const e in t)this[e]=e in r?r[e](t[e]):t[e]};for(const t in n)c.prototype[t]=(r[t]=i(n[t],e))();return"object"==typeof t&&t&&!isFinite(t.length)&&(c.prototype=new c(t)),t=>new c(t)},array(t,e,n,o={}){const r=i(o,e),c=e.realArray?function t(e){return Object.setPrototypeOf("object"==typeof e?e.map(r):Array(t.prototype.length),t.prototype)}:function t(e){"object"==typeof e?(this.length=0,e.forEach((t=>this.push(r(t))))):this.length=t.prototype.length};return c.prototype=[],c.prototype.constructor=c,t&&"function"==typeof t.forEach&&t.forEach((t=>c.prototype.push(r(t)))),t=>new c(t)}};function i(t,e){const i=t.type||"object";if("string"==typeof i){const c=r[i](t.default,e,t.properties,t.items);return e.check||e.checkType?t=>void 0===t?c():n(t)===i?c(t):o.notType(n(t),[i]):t=>void 0===t?c():n(t)===i?c(t):t}{const c={a:()=>{}},s=i[0]||"a";return i.forEach((n=>c[n]=r[n](t.default,e,t.properties,t.items))),e.check||e.checkType?t=>{if(void 0!==t){const e=n(t);return e in c?c[e](t):o.notType(e,i)}return c[s]()}:t=>{if(void 0!==t){const e=n(t);return e in c?c[e](t):t}return c[s]()}}}const c=Object.assign(((t={},e)=>i(t,new s(e))),{check:!1,checkKey:!1,checkType:!1,realArray:!1});function s(t){Object.assign(this,t)}s.prototype=c,t.exports=c})()}},e={};!function n(o){var r=e[o];if(void 0!==r)return r.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,n),i.exports}(569)})();})(module)